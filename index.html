<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <style>
      body {
        padding-top:30px;
      }
      .container {
        margin-bottom:50px;
      }
      #export {
      }
    </style>
  </head>
  <body>
      <div class="container">
          <h4>Flatwork Pour Sheet</h4>
          <form novalidate>
            <div class="row">
              <div class="col-md-6">
              <div class="form-group">
                  <label>Builder</label>
                  <input type="text" id="builder-text" class="form-control">
              </div>
              <div class="form-group">
                  <label>Address</label>
                  <input type="text" id="address-text" class="form-control">
              </div>
              <div class="form-group form-row calc-row" id="driveway" data-label="Driveway">
                  <label for="staticEmail" class="col-sm-2 col-4 col-form-label">Driveway</label>
                  <div class="col-sm-10 col">
                      <div class="form-row">
                          <div class="col-sm-6 col">
                              <input type="number" placeholder="Width" data-type="width" class="width form-control">
                          </div>
                          <div class="col-sm-6 col">
                              <input type="number" placeholder="Height" data-type="height" class="form-control">
                          </div>
                      </div>
                      <small class="form-text text-right text-muted total">Total Sqft: <span>0</span></small>
                  </div>
              </div>
              <div class="form-group form-row calc-row" id="approach" data-label="Approach">
                  <label for="staticEmail" class="col-sm-2 col-4 col-form-label">Approach</label>
                  <div class="col-sm-10 col">
                      <div class="form-row">
                          <div class="col-sm-6 col">
                              <input type="number" placeholder="Width" data-type="width" class="form-control">
                          </div>
                          <div class="col-sm-6 col">
                              <input type="number" placeholder="Height" data-type="height" class="form-control">
                          </div>
                      </div>
                      <small class="form-text text-right text-muted total">Total Sqft: <span>0</span></small>
                  </div>
              </div>
              <div class="form-group form-row calc-row" id="wing" data-label="Wing">
                  <label for="staticEmail" class="col-sm-2 col-4 col-form-label">Wing</label>
                  <div class="col-sm-10 col">
                      <div class="form-row">
                          <div class="col-sm-6 col">
                              <input type="number" placeholder="Width" data-type="width" class="form-control">
                          </div>
                          <div class="col-sm-6 col">
                              <input type="number" placeholder="Height" data-type="height" class="form-control">
                          </div>
                      </div>
                      <small class="form-text text-right text-muted total">Total Sqft: <span>0</span></small>
                  </div>
              </div>
              <div class="form-group form-row calc-row" id="entry-walk" data-label="Entry Walk">
                  <label for="staticEmail" class="col-sm-2 col-4 col-form-label">Entry Walk</label>
                  <div class="col-sm-10 col">
                      <div class="form-row">
                          <div class="col-sm-6 col">
                              <input type="number" placeholder="Width" data-type="width" class="form-control">
                          </div>
                          <div class="col-sm-6 col">
                              <input type="number" placeholder="Height" data-type="height" class="form-control">
                          </div>
                      </div>
                      <small class="form-text text-right text-muted total">Total Sqft: <span>0</span></small>
                  </div>
              </div>
              <div class="form-group form-row calc-row" id="city-walk" data-label="City Walk">
                  <label for="staticEmail" class="col-sm-2 col-4 col-form-label">City Walk</label>
                  <div class="col-sm-10 col">
                      <div class="form-row">
                          <div class="col-sm-6 col">
                              <input type="number" placeholder="Width" data-type="width" class="form-control">
                          </div>
                          <div class="col-sm-6 col">
                              <input type="number" placeholder="Height" data-type="height" class="form-control">
                          </div>
                      </div>
                      <small class="form-text text-right text-muted total">Total Sqft: <span>0</span></small>
                  </div>
              </div>
              <div class="form-group form-row calc-row" id="patio" data-label="Patio">
                  <label for="staticEmail" class="col-sm-2 col-4 col-form-label">Patio</label>
                  <div class="col-sm-10 col">
                      <div class="form-row">
                          <div class="col-sm-6 col">
                              <input type="number" placeholder="Width" data-type="width" class="form-control">
                          </div>
                          <div class="col-sm-6 col">
                              <input type="number" placeholder="Height" data-type="height" class="form-control">
                          </div>
                      </div>
                      <small class="form-text text-right text-muted total">Total Sqft: <span>0</span></small>
                  </div>
              </div>
              <div class="form-group form-row calc-row" id="steps" data-label="Steps">
                  <label for="staticEmail" class="col-sm-2 col-4 col-form-label">Steps</label>
                  <div class="col-sm-10 col">
                      <div class="form-row">
                          <div class="col-sm-6 col">
                              <input type="number" placeholder="Width" data-type="width" class="form-control">
                          </div>
                          <div class="col-sm-6 col">
                              <input type="number" placeholder="Height" data-type="height" class="form-control">
                          </div>
                      </div>
                      <small class="form-text text-right text-muted total">Total Sqft: <span>0</span></small>
                  </div>
              </div>
              </div>
              <div class="col-md-6">
              <div id="export">
                  <div class="row">
                      <div class="col-sm-6 col">
                          <div class="card mb-4">
                              <div class="card-body">
                                  <h6 class="card-subtitle mb-2 text-muted">Builder</h6>
                                  <span id="builder"></span>
                              </div>
                          </div>
                      </div>
                      <div class="col-sm-6 col">
                          <div class="card mb-4">
                              <div class="card-body">
                                  <h6 class="card-subtitle mb-2 text-muted">Address</h6>
                                  <span id="address"></span>
                              </div>
                          </div>
      
                      </div>
                  </div>
      
                  <table class="table table-bordered">
                      <thead class="thead-light">
                          <tr>
                              <th></th>
                              <th>Width</th>
                              <th>Height</th>
                              <th>Est SqFt</th>
                          </tr>
                      </thead>
                      <tbody>
                      </tbody>
                      <tfoot>
                          <tr>
                              <th colspan="3" class="text-right">
                                  Total Sqft
                              </th>
                              <th id="complete-total">0</th>
                          </tr>
                      </tfoot>
                  </table>
              </div>
              <button type="submit" id="submit" class="hide btn btn-primary">Generate PDF</button>
              </div>
              </div>
          </form>
      </div>
        
        
    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
    <script src="js/html2pdf.bundle.min.js"></script>
    <script>
        jQuery(document).ready(function($) {

        $('#builder-text').on('keyup', function() {
        $('#builder').text($(this).val())
        });
        $('#address-text').on('keyup', function() {
        $('#address').text($(this).val())
        }); 
        $('.calc-row input').on('keyup', function(){
        var type = $(this).attr('data-type');
        var id = $(this).parents('.calc-row').attr('id');
        var name = $(this).parents('.calc-row').attr('data-label');
            var width;
        var height;
        if(type == 'width') {
            height = $(this).parents('.calc-row').find('input[data-type="height"]').val();
        width = $(this).val();
        } else {
            width = $(this).parents('.calc-row').find('input[data-type="width"]').val();
        height = $(this).val();
        }
        var total = parseFloat(width * height);
        var totalFormatted = total.toLocaleString('en-US', { minimumFractionDigits: 1 });
        var test = width * height;
        $(this).parents('.calc-row').find('.total span').text(totalFormatted);


        if ($('tr#' + id).length) {
        var row = $('table').find('tr#' + id);
        row.find('td.width').text(width);
        row.find('td.height').text(height);
        row.find('td.total').text(totalFormatted);
        row.find('td.total').attr('data-total', total);
        } else {
        var row = '<tr id=' + id + '>';
        row += '<td>' + name + '</td>';
        row += '<td class="width">' + width + '</td>';
        row += '<td class="height">' + height + '</td>';
        row += '<td class="total" data-total=' + total + '>' + totalFormatted + '</td>';
        row += '</tr>';

        $('table tbody').append(row);  
        }
        var completeTotal = 0;
        $( "table tbody tr" ).each(function( index ) {
            var value = $(this).find('.total').attr('data-total');
        completeTotal += parseFloat(value);
        
        
        });
        $('#complete-total').text(completeTotal.toLocaleString('en-US', { minimumFractionDigits: 1 }));

        });

        function happyUrl(string) {
            var happy = string.replace(/\s+/g, '-').toLowerCase();
            return happy;
        }

        $('#submit').click(function(e) {
          e.preventDefault();
          var filename = 'flatwork-sheet';
            var date    = new Date(),
            yr      = date.getFullYear(),
            month   = date.getMonth() < 10 ? '0' + date.getMonth() : date.getMonth(),
            day     = date.getDate()  < 10 ? '0' + date.getDate()  : date.getDate(),
            newDate = yr + '-' + month + '-' + day;
            
            
            if($('#builder-text').val().length) {
                filename += '-' + happyUrl($('#builder-text').val());
            }
            if($('#address-text').val().length) {
                filename += '-' + happyUrl($('#address-text').val());
            }
            filename += '-' + newDate;
          var element = document.getElementById('export');
          html2pdf(element, 
            {
              margin: [15, 15, 15, 15],
              filename: filename,
              html2canvas: { dpi: 300, letterRendering: true },
            }
          );
          alert('done');
        });
        });    
    
    </script>
  </body>
</html>